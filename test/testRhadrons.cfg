process PROD2  = 
{
   # initialize  MessageLogger
   include "FWCore/MessageService/data/MessageLogger.cfi"
   replace MessageLogger.cout.threshold = "LOG"
   replace MessageLogger.cerr.default.limit = 10

   service = Timing {}
   
   service = RandomNumberGeneratorService
   {
      untracked uint32 sourceSeed = 123456789
      PSet moduleSeeds =
      {
         untracked uint32 VtxSmeared = 98765432
         untracked uint32 g4SimHits = 9876
      }
   }

 source = PoolSource {
	untracked vstring fileNames = { 'file:rHadronsGen-600-mc-1-100.root' }
    untracked int32 maxEvents = 1
  }

   # SIM + DIGI part #################################################
   #
   #   include "Configuration/Generator/test/FullSim.cfi"		

module VtxSmeared = VertexGenerator
   {
      string type = "IOMC/EventVertexGenerators/GaussianEventVertexGenerator"
      double MeanX = 0.
      double MeanY = 0.
      double MeanZ = 0.
      double SigmaX = 0.015
      double SigmaY = 0.015
      double SigmaZ = 53.0  // in mm (as in COBRA/OSCAR)
   }
  
#Geometry
   #
   # include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"
   include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
   es_module = TrackerGeometricDetESModule {}

   # Magnetic Field
   #
   include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

   # Geant4-based CMS Detector simulation
   #
   include "SimG4Core/CustomPhysics/data/CustomPhysics.cfi"
   include "SimG4Core/Application/data/g4SimHits.cfi"
   replace g4SimHits.G4EventManagerVerbosity = 1
   replace g4SimHits.G4TrackingManagerVerbosity = 1

   replace g4SimHits.Physics = {
    string type = "SimG4Core/Physics/CustomPhysics"
    using customPhysicsSetup
    bool DummyEMPhysics = false
    bool CutsPerRegion = true
    double DefaultCutValue = 1000.  # cuts in cm, i.e. 10m
    double G4BremsstrahlungThreshold = 50 # cut in GeV
    untracked int32 Verbosity = 0   # 1 will print cuts as they get set fdrom DD
                                    # 2 will do as 1 + will dump Geant4 table of cuts
    double GFlashEmin = 1.0
    double GFlashEmax = 1000000.0
    double GFlashEToKill = 0.1
   }

   replace  g4SimHits.Generator =
      {
         string HepMCProductLabel = "VtxSmeared"  # alternative would be :
                                                  # InputTag MCProductLabel = source
                                                  # to get the "original" on (without vtx smearing);
                                                  # NO other MCProduct's/labels in edm::Event
         bool ApplyPtCuts  = true
         bool ApplyEtaCuts = true
         bool ApplyPhiCuts = false
         double MinPhiCut  = -3.14159265358979323846 # in radians
         double MaxPhiCut  =  3.14159265358979323846 # according to CMS conventions
         double MinEtaCut  = -5.5
         double MaxEtaCut  =  5.5
         double MinPtCut   =  0.040  # the pt-cut is in GeV (CMS conventions)
         double MaxPtCut   =  99999. # the ptmax=99.TeV in this case
         double DecLenCut   =  0.1 # the minimum decay length in cm (!) for mother tracking
         untracked int32 Verbosity = 1
      }


   replace g4SimHits.Watchers = {
      {
               string type = "TrackingVerboseAction"
               untracked bool  DEBUG = false
               untracked bool  CheckForHighEtPhotons = false
               untracked int32 EventMin = 0
               untracked int32 EventMax = 0
               untracked int32 EventStep = 1
               untracked int32 TrackMin = 0
               untracked int32 TrackMax = 0
               untracked int32 TrackStep = 1
               untracked int32 VerboseLevel = 1
      }   }
   
   # This is the full sequence of digitizers
   # (Pixels, SiStrips, Ecal, Hcal, Muon(CSC,DT,RPC)
   # MixingModule included (in the zero-pileup mode)
   # it "returns" sequence called doAllDigi which can
   # be directly placed in the path
   #
   include "SimG4Core/Application/data/Digi.cff"

   module dump =  EventContentAnalyzer {}

    path p1 = { g4SimHits, dump}
   //path p1 = { VtxSmeared,g4SimHits, doAllDigi}
   //path p = {dump}

#################################################

   # Event, etc. output
   #
   module GEN-SIM-DIGI = PoolOutputModule 
   { 
     untracked string fileName = "digi.root" 
     untracked vstring outputCommands = {
       "keep *"
#       "keep edmHepMCProduct_*_*_*"      
     }
#     untracked PSet SelectEvents = {
#           vstring SelectEvents = {"p"}
#        }

   }

   
  
   endpath outpath = { GEN-SIM-DIGI }
   
}	
